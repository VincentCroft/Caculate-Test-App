/*以下为项目说明
 软件名称：Caculate-Test-App
 面向的用户：小学生
 主要功能：训练口算
 用法说明：跟着菜单提示操作就行
 设计创新点：可以选择是否启用自动保存功能，可以选择错题保存路径，可以难度调档，可以自定义出题数量，有结果反馈，具有针对性
           能够对错题表按运行次数进行归类，可以统计口算用时和正确率
 开发环境：Jetbrains Clion2022.2(采用MinGW编译器，版本w64 9.0 采用CMake 版本3.23.2)
          EasyX For Mingw 2022版库文件
 关于EasyX：
    easyx4mingw_20220606.zip
	├ include <folder>
	│	├ easyx.h 				// 头文件(提供了当前最新版本的接口)
	│	└ graphics.h			// 头文件(在 easyx.h 的基础上，保留了若干旧接口)
	├ lib32 <folder>
	│	└ libeasyx.a			// 针对 TDM-GCC 4.8.1 及以上版本的 32 位库文件
	├ lib64 <folder>
	│	└ libeasyx.a			// 针对 TDM-GCC 4.8.1 及以上版本的 64 位库文件
	└ lib-for-devcpp_5.4.0
		└ libeasyx.a			// 适用于 DevCpp 5.4.0 GCC MinGW 4.7.2 和 C-Free 5.0
 */

/*此版本为无GUI版（暂时）
 GUI版源码和成果展示可访问https://github.com/VincentCroft/Caculate-Test-App获取更多信息(请阅读README.md)
 并可以获取到已经构建好的程序
 */

//
// Created by VincentCroft on 2022/12/24.
//
#include <graphics.h>//图形界面
#include <stdio.h>
#include <stdlib.h> //随机数，用到rand()函数
#include <time.h> //更改种子，统计时间用到clock()函数
#include <conio.h>
#include <windows.h>
#include <math.h>
#include <string.h>

//全局变量
int a, b; //a,b分别是两个操作数
int c;//调整此参数以求出多少以内的计算题
int answer; //用户输入的答案
int value;//该题的正确答案
int right = 0; //恭喜你答对了！的题目数量
int number; //自定义出题个数
int op,set; //菜单选项
int count=0;//用于统计WrongAnswerSheet
double begintime, endtime;//用于统计运行时间
char str[2];//用于拼接运算符号
char Title[40];//用于保存题目
char SavePlace[100];// 用于保存路径
char sheetcount[40];

void graph()//提供图形界面
{
    char Menu1[]={"===========菜单=========="};
    char Menu2[]={"=    输入1. 出10道题    ="};
    char Menu3[]={"=    输入2. 出100道题   ="};
    char Menu4[]={"=    输入3. 出1000道题  ="};
    char Menu5[]={"= 输入4. 自定义出题数目 ="};
    char Menu6[]={"=    输入0. 退出程序    ="};
    char Menu7[]={"=========================="};
    short win_width,win_height;//定义窗口的宽度和高度
    win_width = 400;win_height = 400;//调整窗口大小
    initgraph(win_width,win_height);//初始化窗口（黑屏）
    LOGFONT f;//字体样式指针
    gettextstyle(&f);					//获取字体样式
    _tcscpy(f.lfFaceName,_T("宋体"));	//设置字体为宋体
    f.lfQuality = ANTIALIASED_QUALITY;    // 设置输出效果为抗锯齿
    settextstyle(&f);                     // 设置字体样式
    settextcolor(WHITE);				//BLACK在graphic.h头文件里面被定义为黑色的颜色常量
    outtextxy(100, 40, Menu1);
    outtextxy(100, 60, Menu2);
    outtextxy(100, 80, Menu3);
    outtextxy(100, 100, Menu4);
    outtextxy(100, 120, Menu5);
    outtextxy(100, 140, Menu6);
    outtextxy(100, 160, Menu7);

    setfillcolor(BLACK); // 设置填充颜色为白色

    // 定义五个按钮的位置和大小
    int button_w = 50, button_h = 20, button_spacing = 10;
    int button1_x = 50, button1_y = 250;
    int button2_x = button1_x + button_w + button_spacing, button2_y = button1_y;
    int button3_x = button2_x + button_w + button_spacing, button3_y = button1_y;
    int button4_x = button3_x + button_w + button_spacing, button4_y = button1_y;
    int button5_x = button4_x + button_w + button_spacing, button5_y = button1_y;

    // 绘制五个按钮
    fillrectangle(button1_x, button1_y, button1_x + button_w, button1_y + button_h); // 绘制矩形
    fillrectangle(button2_x, button2_y, button2_x + button_w, button2_y + button_h);
    fillrectangle(button3_x, button3_y, button3_x + button_w, button3_y + button_h);
    fillrectangle(button4_x, button4_y, button4_x + button_w, button4_y + button_h);
    fillrectangle(button5_x, button5_y, button5_x + button_w, button5_y + button_h);

    // 在按钮上写上文本
    settextcolor(WHITE); // 设置文本颜色为黑色
    settextstyle(12, 0, _T("微软雅黑")); // 设置文本样式
    outtextxy(button1_x + 15, button1_y + 5, _T("按钮1"));
    outtextxy(button2_x + 15, button2_y + 5, _T("按钮2"));
    outtextxy(button3_x + 15, button3_y + 5, _T("按钮3"));
    outtextxy(button4_x + 15, button4_y + 5, _T("按钮4"));
    outtextxy(button5_x + 15, button5_y + 5, _T("关闭程序"));
    while (true)
    {
        // 获取鼠标点击位置
        MOUSEMSG msg = GetMouseMsg();//接收鼠标信息
        //printf("坐标为（%d,%d）", msg.x, msg.y);//显示鼠标坐标

        if (MouseHit())
        {
            // 判断点击是否在按钮上
            switch (msg.uMsg)
            {//uMsg判断鼠标信息是什么信息(左键信息或者右键信息)
                case WM_LBUTTONDOWN:
                    if (msg.x > button5_x && msg.x < button5_x + button_w && msg.y > button5_y &&
                        msg.y < button5_y + button_h) {
                        // 点击在按钮上，关闭程序
                        cleardevice();//刷新一下，防止窗口颜色不变
                        closegraph();
                    }break;
                case WM_RBUTTONDOWN://右键按下
                    if (msg.x > button5_x && msg.x < button5_x + button_w && msg.y > button5_y &&
                        msg.y < button5_y + button_h) {
                        // 点击在按钮上，关闭程序
                        cleardevice();//刷新一下，防止窗口颜色不变
                        closegraph();
                    }break;
            }
        }
        // 等待一段时间
        Sleep(1);
    }

    system("pause");//暂停，为了显示
    closegraph();
}

void SheetCount()
{
    count++;
    char str1[5];
    char str2[]={"-----Your Wrong Answer Sheet"};
    char str3[]={"-----"};
    itoa(count, str1, 10);
    strcat(str2,str1);
    strcat(str2,str3);
    strcpy(sheetcount,str2);

}

void TitleSave(int a,int b)
{
    char str1[40];
    char str2[10];
    char str3[20];
    char str4[]={"="};
    char str5[]={"    Your Wrong Answer Is: "};
    char str6[20];
    itoa(a, str1, 10);
    itoa(b, str2, 10);
    itoa(answer, str6, 10);
    itoa(value, str3, 10);
    strcat(str1,str);
    strcat(str1,str2);
    strcat(str1,str4);
    strcat(str1,str3);
    strcat(str1,str5);
    strcat(str1,str6);
    strcpy(Title, str1);
}

void WrongSave(char Wrong[])
{
    FILE *fp;
    fp=fopen(SavePlace,"a+");
    fputs(Wrong, fp);
    fprintf(fp, "\r\n");
    //  关闭流fp。刷新所有的缓冲区。
    fclose(fp);
}

void FileToSave()
{
    FILE *fp,*fp1;
    char name[100];
    SheetCount();
    printf("请输入想要保存错题的路径“例如：E:\\test.txt”)：");
    scanf("%s",name);
    strcpy(SavePlace,name);
    fp = fopen(name,"r");
    if(fp!= NULL)          // 判断要创建的文件是否存在
    {
        printf("(文件存在,已经保存错题)\n");
    }
    else
    {
        //   如果文件不存在则创建文件
        printf("(文件不存在，将创建文件来初始化)\n");
        fp1 = fopen(name,"w");
        //   创建文件,"w"该文件可写
        //  w:创建一个用于写入的空文件。如果文件名称与已存在的文件相同，则会删除已有文件的内容，文件被视为一个新的空文件。
        if(fp1==NULL)
        {
            //  文件没有创建则把一个描述性错误消息输出到标准错误 stderr    void perror(const char *str)
            perror("Error: ");
        }
    }
    fp=fopen(name,"a+");
    fputs(sheetcount, fp);
    fprintf(fp, "\r\n");
    //  关闭流fp。刷新所有的缓冲区。
    fclose(fp);
}

void NemuPrint()
{
    // 打印菜单
    printf("==========菜单==========\n");
    printf("输入1. 出10道题           =\n");
    printf("输入2. 出100道题          =\n");
    printf("输入3. 出1000道题         =\n");
    printf("输入4. 自定义出题数目      =\n");
    printf("输入0. 退出程序           =\n");
    printf("=======================\n");
}

void SetPrint()
{
    // 打印难度档
    printf("=========难度选择========\n");
    printf("输入1. 出10以内的题目      =\n");
    printf("输入2. 出100以内的题目     =\n");
    printf("输入3. 出1000以内的题目    =\n");
    printf("=======================\n");
}

void Feedback()
{
    double n,m,x;
    n=number;
    m=right;
    x=(m/n)*100;
    printf("=======================\n");
    printf("本次测试一共有%d题，你答对了%d题\n",number,right);
    printf("你的正确率为%lf%%,你总共用时%lf秒\n",x,(endtime-begintime)/1000);
    if(x<50)            //该判断用于实现对作答情况进行反馈
    {
        if(x<25)
        {
            printf("(Tips:小朋友，再这样下去要被老师找去喝茶啦)\n");
        }
        else
            printf("(Tips:小朋友，你要加油啊)\n");
    }
    else
    {
        if(x>75)
        {
            printf("(Tips:小朋友，你实在是太棒啦)\n");
        }
        else
            printf("(Tips:小朋友，你还不错)\n");
    }
    printf("=======================\n");
}

// 加法题目
void Add()
{
    srand(time(NULL));
    a = rand() % (c + 1);
    b = rand() % (c + 1);
    printf("%d+%d=", a, b);
    scanf("%d", &answer);
    value=a+b;
    str[0]='+';
    TitleSave(a,b);
    if (a + b == answer)
    {
        printf("恭喜你答对了！\n");
        right++;
    }
    else
    {
        printf("很遗憾你答错了！\n");
        WrongSave(Title);
    }
}

// 减法题目
void Sub()
{
    srand(time(NULL));
    do
    {
        a = rand() % (c + 1);
        b = rand() % (c + 1);
    } while (a < b);
    printf("%d-%d=", a, b);
    scanf("%d", &answer);
    value=a-b;
    str[0]='-';
    TitleSave(a,b);
    if (a - b == answer)
    {
        printf("恭喜你答对了！\n");
        right++;
    }
    else
    {
        printf("很遗憾你答错了！\n");
        WrongSave(Title);
    }
}

//乘法题目
void Multiplication()
{
    srand(time(NULL));
    a = rand() % (c + 1);
    b = rand() % (c + 1);
    printf("%d*%d=", a, b);
    scanf("%d", &answer);
    value=a*b;
    str[0]='*';
    TitleSave(a,b);
    if (a * b == answer)
    {
        printf("恭喜你答对了！\n");
        right++;
    }
    else
    {
        printf("很遗憾你答错了！\n");
        WrongSave(Title);
    }
}

//除法题目
void Div()
{
    srand(time(NULL));
    do
    {
        a = rand() % (c + 1);
        b = rand() % (c + 1);
    } while (a < b || a % b != 0 || b == 0);
    printf("%d/%d=", a, b);
    scanf("%d", &answer);
    value=a/b;
    str[0]='/';
    TitleSave(a,b);
    if (a / b == answer)
    {
        printf("恭喜你答对了！\n");
        right++;
    }
    else
    {
        printf("很遗憾你答错了！\n");
        WrongSave(Title);
    }
}

//出题的，number是出题的个数
void Give(int number)
{
    printf("本次出题数量是%d题\n", number);
    begintime = clock();    //计时开始
    for (int i = 1; i <= number; i++)
    {
        switch (rand() % 4)
        {
            case 0:
                Add();
                break;
            case 1:
                Sub();
                break;
            case 2:
                Multiplication();
                break;
            case 3:
                Div();
                break;
        }
    }
    endtime = clock();    //计时结束
}

void result()// 输出结果
{
    while (1)
    {
        graph();
        printf("请输入功能所在的序号：");
        scanf("%d", &op);
        if(op == 0)
        {
            printf("感谢使用");
            break;
        }
        SetPrint();
        printf("请输入功能所在的序号：");
        scanf("%d", &set);
        switch (set)//难度调档
        {
            case 1:
                c=9;
                break;
            case 2:
                c=99;
                break;
            case 3:
                c=999;
                break;
        }
        printf("是否启用错题保存功能？(y/n):");
        char Justice;
        scanf("%s",&Justice);
        if(Justice=='y')
        {
            printf("=======保存功能启用========\n");
            FileToSave();
        }
        if(op == 0)
        {
            printf("感谢使用");
            break;
        }
        else
        {
            switch (op)
            {
                case 1:
                    number = 10;
                    Give(number);
                    break;
                case 2:
                    number = 100;
                    Give(number);
                    break;
                case 3:
                    number = 1000;
                    Give(number);
                    break;
                case 4:
                    printf("请输入你要出题的个数：");
                    scanf("%d", &number);
                    Give(number);
                    break;
            }
            Feedback();
            printf("\n");
            right = 0;
        }
    }
}

int main()
{
    result();
    return 0;
}
